swagger: "2.0"
info:
  title: "Hub BConnector API"
  description: "API de integração do Hub BConnector. Este hub atua como camada intermediária entre ERPs e Marketplaces, provendo canonização de dados e sincronização multi-tenant.\n\n### Papéis de Acesso (Roles)\n- **Operador (Admin/White Label)**: Acesso total ao sistema, configurações globais e logs.\n- **Fornecedor (Supplier)**: Visão limitada aos seus próprios produtos, estoques e sincronizações."
  version: "1.0.0"
host: "api.bconnector.com.br"
basePath: "/v1"
schemes:
  - "https"
consumes:
  - "application/json"
produces:
  - "application/json"

tags:
  - name: "Auth"
    description: "Autenticação e Autorização"
  - name: "Core"
    description: "Gestão de White Labels, Sellers e Fornecedores"
  - name: "Products"
    description: "Gestão de Produtos Canônicos e Blueprints"
  - name: "Stock"
    description: "Controle e Sincronização de Estoque"
  - name: "Orders"
    description: "Gestão de Pedidos (Mercado Livre e outros)"

paths:
  /auth/mercado-livre/callback:
    get:
      tags:
        - "Auth"
      summary: "OAuth Callback do Mercado Livre"
      description: "Endpoint para receber o code/token do Mercado Livre após autorização do seller. **Permissão**: Operador"
      responses:
        200:
          description: "Sucesso na autorização"
  
  /products:
    get:
      tags:
        - "Products"
      summary: "Listar produtos canônicos"
      description: "Retorna a lista de produtos. Se o perfil for **Fornecedor**, retorna apenas seus itens. **Permissão**: Operador, Fornecedor"
      responses:
        200:
          description: "Lista de produtos"
          schema:
            type: "array"
            items:
              $ref: "#/definitions/Product"
    post:
      tags:
        - "Products"
      summary: "Criar produto canônico"
      description: "Cria um novo produto na base canônica do hub. **Permissão**: Operador, Fornecedor"
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/ProductInput"
      responses:
        201:
          description: "Produto criado"

  /stock/sync:
    post:
      tags:
        - "Stock"
      summary: "Atualização manual de estoque (Webhook ERP Simulator)"
      description: "Recebe atualização de estoque (ex: via Bling) e dispara replicação. **Permissão**: Operador"
      parameters:
        - in: "body"
          name: "body"
          required: true
          schema:
            $ref: "#/definitions/StockUpdate"
      responses:
        202:
          description: "Atualização aceita para processamento"

  /orders/mercado-livre/{order_id}:
    get:
      tags:
        - "Orders"
      summary: "Consulta pedido no Mercado Livre"
      description: "Busca detalhes de um pedido específico diretamente ou via cache do Hub. **Permissão**: Operador"
      parameters:
        - name: "order_id"
          in: "path"
          required: true
          type: "string"
      responses:
        200:
          description: "Detalhes do pedido"
          schema:
            $ref: "#/definitions/Order"

securityDefinitions:
  ApiKeyAuth:
    type: "apiKey"
    in: "header"
    name: "X-API-KEY"
    description: "Chave de acesso. Ex: 7bb6be21-d76e-4b76-acab-37afb0eaa057"

definitions:
  Product:
    type: "object"
    properties:
      id:
        type: "string"
        format: "uuid"
      sku_canonical:
        type: "string"
      name:
        type: "string"
      description:
        type: "string"
      supplier_id:
        type: "string"
        format: "uuid"
      status:
        type: "string"
        enum: ["active", "inactive", "draft"]
      created_at:
        type: "string"
        format: "date-time"

  ProductInput:
    type: "object"
    required: ["sku_canonical", "name", "supplier_id"]
    properties:
      sku_canonical:
        type: "string"
      name:
        type: "string"
      description:
        type: "string"
      supplier_id:
        type: "string"
        format: "uuid"

  StockUpdate:
    type: "object"
    required: ["sku", "quantity"]
    properties:
      sku:
        type: "string"
      quantity:
        type: "integer"
      warehouse_id:
        type: "string"

  Order:
    type: "object"
    properties:
      id:
        type: "string"
      external_id:
        type: "string"
      status:
        type: "string"
      total_amount:
        type: "number"
      items:
        type: "array"
        items:
          type: "object"
          properties:
            sku:
              type: "string"
            quantity:
              type: "integer"
            unit_price:
              type: "number"

security:
  - ApiKeyAuth: []
